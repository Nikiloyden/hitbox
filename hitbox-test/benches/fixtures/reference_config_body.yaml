# Reference benchmark configuration with body predicates (dynamic dispatch version)
# This configuration mirrors the static dispatch body benchmark

backend:
  type: Moka
  max_capacity: 10000
  key:
    format: Bitcode
  value:
    format: Bincode
    compression:
      type: Disabled

endpoint:
  request:
    - Method: POST
    - Path: "/v1/users/{user_id}/orders"
    - Header:
        authorization:
          exist: true
    - Header:
        x-tenant-id:
          exist: true
    - Header:
        x-idempotency-key:
          exist: true
    - Body:
        jq:
          expression: ".order.customer_id"
          exist: true

  response:
    - Status:
        class: Success
    - Header:
        content-type:
          exist: true
    - Header:
        cache-control:
          exist: true
    - Body:
        jq:
          expression: ".data | type"
          eq: "array"

  extractors:
    - Method:
    - Path: "/v1/users/{user_id}/orders"
    - Query: include
    - Query: fields
    - Header: x-tenant-id
    - Header:
        name: authorization
        transform:
          - Hash
    - Header: x-idempotency-key
    - Body:
        jq: "{customer_id: .order.customer_id, shipping: .order.shipping_method}"

  policy:
    Enabled:
      ttl: 300
